<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="prev" title="2022 Posts" href="../index.html" />

    <!-- Generated with Sphinx 6.2.1 and Furo 2023.05.20 -->
        <title>Forms in Django 4.0+ - David Smith&#39;s blog documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?digest=e6660623a769aa55fea372102b9bf3151b292993" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">David Smith's blog  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  
  <span class="sidebar-brand-text">David Smith's blog  documentation</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">2022 Posts</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of 2022 Posts</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Forms in Django 4.0+</a></li>
</ul>
</li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="forms-in-django-4-0">
<h1>Forms in Django 4.0+<a class="headerlink" href="#forms-in-django-4-0" title="Permalink to this heading">#</a></h1>
<section id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this heading">#</a></h2>
<p>Prior to Django 4.0 forms were rendered by string concatenation. A number of 3rd party
packages allowed for forms to be rendered as templates e.g. floppy forms, crispy-forms.</p>
<p>Django 4.0 introduced the capability to render forms using the template engine.
This allowed the form template to be set per form class or per instance if a template
name is provided when calling <code class="docutils literal notranslate"><span class="pre">render()</span></code>.</p>
</section>
<section id="how-to">
<h2>How-to<a class="headerlink" href="#how-to" title="Permalink to this heading">#</a></h2>
<p>Letâ€™s see an example of how a form may currently be rendered in a template and see
how I would use the new capabilities in Django 4.0.</p>
<p>I found the example below from one of Djangoâ€™s own projects. It may also be that the
form is written out in full in multiple places increasing the maintenance burden, let us
also see if we simplify the template and reduce the need for repetition.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>  <span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_title&quot;</span><span class="p">&gt;</span>Title: <span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.title.errors</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.title.errors</span><span class="o">|</span><span class="nf">join</span><span class="s2">:&quot;, &quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_language&quot;</span><span class="p">&gt;</span>Language:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.language</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="nv">form.language.errors</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span><span class="ni">&amp;nbsp;&amp;nbsp;</span><span class="cp">{{</span> <span class="nv">form.language.errors</span><span class="o">|</span><span class="nf">join</span><span class="s2">:&quot;, &quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_version&quot;</span><span class="p">&gt;</span>Version:<span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.version</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="nv">form.version.errors</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span><span class="ni">&amp;nbsp;&amp;nbsp;</span><span class="cp">{{</span> <span class="nv">form.version.errors</span><span class="o">|</span><span class="nf">join</span><span class="s2">:&quot;, &quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_tag_list&quot;</span><span class="p">&gt;</span>Tags: <span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.tags.errors</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.tags.errors</span><span class="o">|</span><span class="nf">join</span><span class="s2">:&quot;, &quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span> <span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.tags</span> <span class="cp">}}</span> <span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>Use commas between tag names, and hyphens for multiple words, like &quot;tag1, tag2, tag3-with-long-name&quot;<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_code&quot;</span><span class="p">&gt;</span>Code: <span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.code.errors</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.code.errors</span><span class="o">|</span><span class="nf">join</span><span class="s2">:&quot;, &quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.code</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">label</span> <span class="na">for</span><span class="o">=</span><span class="s">&quot;id_description&quot;</span><span class="p">&gt;</span>Description: <span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.description.errors</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.description.errors</span><span class="o">|</span><span class="nf">join</span><span class="s2">:&quot;, &quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">label</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.description</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span>
      You can use Markdown syntax here (see the sidebar), but <span class="p">&lt;</span><span class="nt">strong</span><span class="p">&gt;</span>raw HTML will be removed<span class="p">&lt;/</span><span class="nt">strong</span><span class="p">&gt;</span>.<span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
    <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<section id="move-data-to-your-model-or-form">
<h3>Move data to your model or form<a class="headerlink" href="#move-data-to-your-model-or-form" title="Permalink to this heading">#</a></h3>
<p>Firstly I would look to see if there are any elements of the form which could
be moved to either the model or form definition. In this scenario I have added
the <code class="docutils literal notranslate"><span class="pre">help_text</span></code> to the Form definition. See
<a class="reference external" href="https://docs.djangoproject.com/en/4.0/topics/forms/modelforms/#overriding-the-default-fields">Overriding the default fields</a>
for more details.</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span>class SnippetForm(forms.ModelForm):
<span class="w"> </span>   title = forms.CharField(validators=[validate_non_whitespace_only_string])
<span class="w"> </span>   description = forms.CharField(
<span class="w"> </span>       validators=[validate_non_whitespace_only_string],
<span class="w"> </span>       widget=forms.Textarea,
<span class="gi">+        help_text=SafeString(&quot;You can use Markdown syntax here (see the sidebar), but &lt;strong&gt;raw HTML will be removed&lt;/strong&gt;.&quot;),</span>
<span class="w"> </span>   )
<span class="w"> </span>   code = forms.CharField(validators=[validate_non_whitespace_only_string], widget=forms.Textarea)

<span class="w"> </span>   class Meta:
<span class="w"> </span>       model = Snippet
<span class="w"> </span>       exclude = (&quot;author&quot;, &quot;bookmark_count&quot;, &quot;rating_score&quot;)
<span class="gi">+        help_texts = {</span>
<span class="gi">+            &#39;tags&#39;: &#39;Use commas between tag names, and hyphens for multiple words, like &quot;tag1, tag2, tag3-with-long-name&quot;.&#39;,</span>
<span class="w"> </span>       }
</pre></div>
</div>
<p>I have chosen to mark the <code class="docutils literal notranslate"><span class="pre">help_text</span></code> as a <code class="docutils literal notranslate"><span class="pre">SafeString</span></code> here to avoid needing
to use the <code class="docutils literal notranslate"><span class="pre">|safe</span></code> filter in the template.</p>
<p>Once this is defined the template can be updated.</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gd">-      &lt;dd&gt;{{ form.tags }} &lt;br /&gt;Use commas between tag names, and hyphens for multiple words, like &quot;tag1, tag2, tag3-with-long-name&quot;&lt;/dd&gt;</span>
<span class="gi">+      &lt;dd&gt;{{ form.tags }} &lt;br /&gt;{{ form.tags.help_text }}&lt;/dd&gt;</span>

<span class="gd">-      You can use Markdown syntax here (see the sidebar), but &lt;strong&gt;raw HTML will be removed&lt;/strong&gt;.&lt;/dd&gt;</span>
<span class="gi">+      {{ form.description.help_text }}&lt;/dd&gt;</span>
</pre></div>
</div>
</section>
<section id="form-template">
<h3>Form Template<a class="headerlink" href="#form-template" title="Permalink to this heading">#</a></h3>
<p>I believe the gold standard is that in your main template you should use <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form</span> <span class="pre">}}</span></code>
to render your form.</p>
<p>Django 4.0 introduced template based rendering for forms which allows us to do
just this! Letâ€™s create a new template for this form.</p>
<p>Currently the form is written out with each field being defined individually.
That is, the template includes <code class="docutils literal notranslate"><span class="pre">form.version</span></code>, <code class="docutils literal notranslate"><span class="pre">form.code</span></code> and so on. In our
example the layout of each field is the same and so we can loop over the forms
fields and render them with the same logic.</p>
<p>Hereâ€™s our template to render the form.</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>  <span class="p">&lt;</span><span class="nt">dl</span><span class="p">&gt;</span>
      <span class="cp">{%</span> <span class="k">for</span> <span class="nv">field</span> <span class="k">in</span> <span class="nv">form</span> <span class="cp">%}</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">field.label_tag</span> <span class="cp">}}</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.errors</span> <span class="cp">%}</span> <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;error&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">field.errors</span><span class="o">|</span><span class="nf">join</span><span class="s2">:&quot;, &quot;</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="p">&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
      <span class="p">&lt;</span><span class="nt">dd</span><span class="p">&gt;</span>
          <span class="cp">{{</span> <span class="nv">field</span> <span class="cp">}}</span>        
          <span class="cp">{%</span> <span class="k">if</span> <span class="nv">field.help_text</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">br</span> <span class="p">/&gt;</span><span class="cp">{{</span> <span class="nv">field.help_text</span> <span class="cp">}}{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="p">&lt;/</span><span class="nt">dd</span><span class="p">&gt;</span>
      <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
      <span class="p">&lt;</span><span class="nt">dt</span><span class="p">&gt;&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span>Save<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;&lt;/</span><span class="nt">dt</span><span class="p">&gt;</span>
  <span class="p">&lt;/</span><span class="nt">dl</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Notable features being used here</p>
<ol class="arabic simple">
<li><p>Using <code class="docutils literal notranslate"><span class="pre">for</span> <span class="pre">field</span> <span class="pre">in</span> <span class="pre">form</span></code> to loop over each field in the form.</p></li>
<li><p><a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#django.forms.BoundField.label_tag"><code class="docutils literal notranslate"><span class="pre">field.label_tag</span></code></a>
to render the <code class="docutils literal notranslate"><span class="pre">&lt;label&gt;</span></code> which is rendered with the <code class="docutils literal notranslate"><span class="pre">for</span></code> attribute to
associate it with the <code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>.</p></li>
<li><p><a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#django.forms.BoundField.errors"><code class="docutils literal notranslate"><span class="pre">field.errors</span></code></a>
to render the fieldâ€™s errors. One additional step here could be make use of
the error list also being rendered with the
<a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#customizing-the-error-list-format">template engine</a>
and provide a separate template for the errors.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">field</span> <span class="pre">}}</span></code> to render the <code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>. NOTE: this is really just the fieldâ€™s
widget rather than the whole field i.e. including labels, errors, help text.</p></li>
<li><p><a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#django.forms.BoundField.help_text"><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">field.help_text</span> <span class="pre">}}</span></code></a>
for the fieldâ€™s help text which is available since we moved it to the form
definition as a preliminary step.</p></li>
</ol>
</section>
<section id="use-the-template">
<h3>Use the template<a class="headerlink" href="#use-the-template" title="Permalink to this heading">#</a></h3>
<p>To use this template to render the form the following changes are required.</p>
<ol class="arabic simple">
<li><p>Define the <a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#template-name"><code class="docutils literal notranslate"><span class="pre">template_name</span></code></a>
on the form definition.</p></li>
<li><p>Set the ordering of the fields using <a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#django.forms.Form.field_order"><code class="docutils literal notranslate"><span class="pre">field_order</span></code></a>
on the form definition. Without this, the form will be rendered in the order which
the fields are defined in the model.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form</span> <span class="pre">}}</span></code> to use the template.</p></li>
</ol>
<p>Letâ€™s see the diff for these changes.</p>
<p>In the form:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>class SnippetForm(forms.ModelForm):
<span class="gi">+    template_name = &quot;cab/snippet_form.html&quot;</span>
<span class="gi">+    field_order = [&quot;title&quot;, &quot;language&quot;, &quot;version&quot;, &quot;tags&quot;, &quot;code&quot;, &quot;description&quot;]</span>
</pre></div>
</div>
<p>In the template:</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w"> </span>
<span class="gd">-    &lt;dl&gt;</span>
<span class="gd">-      &lt;dt&gt;&lt;label for=&quot;id_title&quot;&gt;Title: {% if form.title.errors %}&lt;span class=&quot;error&quot;&gt;{{ form.title.errors|join:&quot;, &quot; }}&lt;/span&gt;{% endif %}&lt;/label&gt;&lt;/dt&gt;</span>
<span class="gd">-      &lt;dd&gt;{{ form.title }}&lt;/dd&gt;</span>
<span class="gd">-      &lt;dt&gt;&lt;label for=&quot;id_language&quot;&gt;Language:&lt;/label&gt;&lt;/dt&gt;</span>
<span class="gd">-      &lt;dd&gt;{{ form.language }}{% if form.language.errors %}&lt;span class=&quot;error&quot;&gt;&amp;nbsp;&amp;nbsp;{{ form.language.errors|join:&quot;, &quot; }}&lt;/span&gt;{% endif %}&lt;/dd&gt;</span>
<span class="gd">-      &lt;dt&gt;&lt;label for=&quot;id_version&quot;&gt;Version:&lt;/label&gt;&lt;/dt&gt;</span>
<span class="gd">-      &lt;dd&gt;{{ form.version }}{% if form.version.errors %}&lt;span class=&quot;error&quot;&gt;&amp;nbsp;&amp;nbsp;{{ form.version.errors|join:&quot;, &quot; }}&lt;/span&gt;{% endif %}&lt;/dd&gt;</span>
<span class="gd">-      &lt;dt&gt;&lt;label for=&quot;id_tag_list&quot;&gt;Tags: {% if form.tags.errors %}&lt;span class=&quot;error&quot;&gt;{{ form.tags.errors|join:&quot;, &quot; }}&lt;/span&gt;{% endif %} &lt;/label&gt;&lt;/dt&gt;</span>
<span class="gd">-      &lt;dd&gt;{{ form.tags }} &lt;br /&gt;Use commas between tag names, and hyphens for multiple words, like &quot;tag1, tag2, tag3-with-long-name&quot;&lt;/dd&gt;</span>
<span class="gd">-      &lt;dt&gt;&lt;label for=&quot;id_code&quot;&gt;Code: {% if form.code.errors %}&lt;span class=&quot;error&quot;&gt;{{ form.code.errors|join:&quot;, &quot; }}&lt;/span&gt;{% endif %}&lt;/label&gt;&lt;/dt&gt;</span>
<span class="gd">-      &lt;dd&gt;{{ form.code }}&lt;/dd&gt;</span>
<span class="gd">-      &lt;dt&gt;&lt;label for=&quot;id_description&quot;&gt;Description: {% if form.description.errors %}&lt;span class=&quot;error&quot;&gt;{{ form.description.errors|join:&quot;, &quot; }}&lt;/span&gt;{% endif %}&lt;/label&gt;&lt;/dt&gt;</span>
<span class="gd">-      &lt;dd&gt;{{ form.description }}&lt;br /&gt;</span>
<span class="gd">-      You can use Markdown syntax here (see the sidebar), but &lt;strong&gt;raw HTML will be removed&lt;/strong&gt;.&lt;/dd&gt;</span>
<span class="gd">-      &lt;dt&gt;&lt;button type=&quot;submit&quot;&gt;Save&lt;/button&gt;&lt;/dt&gt;</span>
<span class="gd">-    &lt;/dl&gt;</span>
<span class="gi">+   {{ form }} </span>
</pre></div>
</div>
<p>With the template being associated with the form means that we can avoid repetition
by having the form logic in a single place and use it where needed by using <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">form</span> <span class="pre">}}</span></code></p>
</section>
</section>
<section id="what-about-the-future">
<h2>What about the future?<a class="headerlink" href="#what-about-the-future" title="Permalink to this heading">#</a></h2>
<p>Django 4.1 will bring several new features to form rendering.</p>
<ol class="arabic">
<li><p>The template to render forms can now be defined at the project level by
settings the template name on your <a class="reference external" href="https://docs.djangoproject.com/en/4.1/ref/settings/#form-renderer"><code class="docutils literal notranslate"><span class="pre">FORM_RENDERER</span></code></a>.</p>
<p>This means that you could have a single template for all of your sites form
and set this centrally without needing to set <code class="docutils literal notranslate"><span class="pre">template_name</span></code> on every form.</p>
<p>In Django 4.0 this <em>could</em> be achieved by overriding the default form
template.</p>
</li>
<li><p>Thereâ€™s a new <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code> based form template which implements <code class="docutils literal notranslate"><span class="pre">&lt;fieldset&gt;</span></code> and
<code class="docutils literal notranslate"><span class="pre">&lt;legend&gt;</span></code> to group related inputs (e.g. radios). Using this template is
highly recommended over the current <a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#as-ul"><code class="docutils literal notranslate"><span class="pre">as_table</span></code></a>,
<a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#as-p"><code class="docutils literal notranslate"><span class="pre">as_p</span></code></a> and
<a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#as-ul"><code class="docutils literal notranslate"><span class="pre">as_ul</span></code></a> templates.</p></li>
<li><p>In addition to the <a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#django.forms.BoundField.label_tag"><code class="docutils literal notranslate"><span class="pre">form.label_tag</span></code></a>
we used above thereâ€™s a
<a class="reference external" href="https://docs.djangoproject.com/en/4.1/ref/forms/api/#django.forms.BoundField.legend_tag"><code class="docutils literal notranslate"><span class="pre">form.legend_tag</span></code></a>
to render the fieldâ€™s label in a <code class="docutils literal notranslate"><span class="pre">&lt;legend&gt;</span></code></p></li>
<li><p>And more, see the <a class="reference external" href="https://docs.djangoproject.com/en/dev/releases/4.1/#forms">full change log!</a></p></li>
</ol>
</section>
<section id="anything-else">
<h2>Anything else?<a class="headerlink" href="#anything-else" title="Permalink to this heading">#</a></h2>
<p>Yes!</p>
<p>As of Django 4.1 Forms and Widgets (i.e. its <code class="docutils literal notranslate"><span class="pre">&lt;input&gt;</span></code>) are renderable using
the template engine. Django also has a strong concept of a field with the
<a class="reference external" href="https://docs.djangoproject.com/en/4.0/ref/forms/api/#django.forms.BoundField"><code class="docutils literal notranslate"><span class="pre">BoundField</span></code></a>
class. This contains all of the information required to render a field such as
its label, errors, help text and its Widget.</p>
<p>As in the example above, this means weâ€™re able to loop over each field in a
form and render each field in the same way. However, say youâ€™d like to have
<code class="docutils literal notranslate"><span class="pre">version</span></code> and <code class="docutils literal notranslate"><span class="pre">tags</span></code> on the same row (maybe needing these fields to be wrapped
in a <code class="docutils literal notranslate"><span class="pre">&lt;div&gt;</span></code>) we would need to go back to writing out the form in full.</p>
<p>Rather, Iâ€™d like to be able to be able to have a <code class="docutils literal notranslate"><span class="pre">BoundField</span></code> as a renderable
object. This would allow a form to be written something like this:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="cp">{{</span> <span class="nv">form.title</span><span class="o">|</span><span class="nf">as_field</span> <span class="cp">}}</span>
   <span class="cp">{{</span> <span class="nv">form.language</span><span class="o">|</span><span class="nf">as_field</span> <span class="cp">}}</span>
   <span class="p">&lt;</span><span class="nt">div</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;row&quot;</span><span class="p">&gt;</span>
      <span class="cp">{{</span> <span class="nv">form.version</span><span class="o">|</span><span class="nf">as_field</span> <span class="cp">}}</span>
      <span class="cp">{{</span> <span class="nv">form.tags</span><span class="o">|</span><span class="nf">as_field</span> <span class="cp">}}</span>
   <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
   <span class="cp">{{</span> <span class="nv">form.code</span><span class="o">|</span><span class="nf">as_field</span> <span class="cp">}}</span>
   <span class="cp">{{</span> <span class="nv">form.description</span><span class="o">|</span><span class="nf">as_field</span> <span class="cp">}}</span>
<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Note that Iâ€™ve added a new <code class="docutils literal notranslate"><span class="pre">as_field</span></code> filter as currently calling <code class="docutils literal notranslate"><span class="pre">str</span></code> on a
<code class="docutils literal notranslate"><span class="pre">BoundField</span></code> returns its Widget and changing this would be too severe a
change in my view. Likely there are other approaches, and therefore further
thought will be required.</p>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          <a class="prev-page" href="../index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">2022 Posts</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, David Smith
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Forms in Django 4.0+</a><ul>
<li><a class="reference internal" href="#background">Background</a></li>
<li><a class="reference internal" href="#how-to">How-to</a><ul>
<li><a class="reference internal" href="#move-data-to-your-model-or-form">Move data to your model or form</a></li>
<li><a class="reference internal" href="#form-template">Form Template</a></li>
<li><a class="reference internal" href="#use-the-template">Use the template</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-about-the-future">What about the future?</a></li>
<li><a class="reference internal" href="#anything-else">Anything else?</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/scripts/furo.js"></script>
    </body>
</html>